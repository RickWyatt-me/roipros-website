---
interface Props {
  /** Product name, e.g. "Custom CNC Routed Sign" */
  title: string;

  /** Primary image URL (can be remote or from /public) */
  imageUrl: string;

  /** Alt text for the image */
  imageAlt?: string;

  /** Display price, e.g. "$249" */
  price: string;

  /** Optional compare-at price for sales, e.g. "$299" */
  compareAtPrice?: string;

  /** Optional small label, e.g. "New", "Limited", "Made to order" */
  badge?: string;

  /** Optional link to the product detail page */
  href?: string;

  /** Inventory state */
  inStock?: boolean;
}

const {
  title,
  imageUrl,
  imageAlt = title,
  price,
  compareAtPrice,
  badge,
  href = '#',
  inStock = true,
} = Astro.props;

const hasDiscount = !!compareAtPrice && compareAtPrice !== price;
---

<article
  class="group flex h-full flex-col overflow-hidden rounded-xl border border-white/7 bg-black/20/80 shadow-[0_18px_45px_rgba(0,0,0,0.55)] backdrop-blur-sm transition-transform transition-shadow duration-200 hover:-translate-y-1 hover:shadow-[0_24px_55px_rgba(0,0,0,0.75)]"
>

  <!-- Image / media -->
  <a
    href={href}
    class="relative block overflow-hidden"
    aria-label={title}
  >
    <div class="aspect-[4/3] w-full bg-black/40">
      <img
        src={imageUrl}
        alt={imageAlt}
        class="h-full w-full object-cover transition duration-300 group-hover:scale-[1.03]"
        loading="lazy"
        decoding="async"
      />
    </div>

    {badge && (
      <span
        class="absolute left-3 top-3 rounded-full bg-roiBlue/90 px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.16em] text-slate-50 shadow-[0_10px_25px_rgba(0,0,0,0.6)]"
      >
        {badge}
      </span>
    )}
  </a>

  <!-- Body -->
  <div class="flex flex-1 flex-col gap-3 px-4 pb-4 pt-3 sm:px-5 sm:pb-5 sm:pt-4">
    <a href={href} class="no-underline hover:no-underline">
      <h3 class="line-clamp-2 text-[0.98rem] font-semibold tracking-tight text-slate-50">
        {title}
      </h3>
    </a>

    <!-- Price / meta row -->
    <div class="mt-1 flex items-baseline justify-between gap-2">
      <div class="flex items-baseline gap-2">
        <span class="text-[1.05rem] font-semibold text-slate-50">
          {price}
        </span>

        {hasDiscount && (
          <span class="text-xs font-medium text-slate-400 line-through">
            {compareAtPrice}
          </span>
        )}
      </div>

      <span
        class={`text-[0.7rem] font-semibold uppercase tracking-[0.16em] ${
          inStock ? 'text-emerald-300/85' : 'text-rose-300/80'
        }`}
      >
        {inStock ? 'In stock' : 'Made to order'}
      </span>
    </div>

    <!-- CTA -->
    <div class="mt-3">
      <button
        type="button"
        class={`btn w-full justify-center ${
          !inStock ? 'opacity-75 cursor-not-allowed' : ''
        }`}
        disabled={!inStock}
      >
        {inStock ? 'View details' : 'Join waitlist'}
      </button>
    </div>
  </div>
</article>
